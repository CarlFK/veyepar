{# episode.html #}
{% extends "base.html" %}

{% block head %}
<title>veyepar: {{episode.name}}</title>
{% endblock %}

{% block content %}

<a href="{% url 'client' client.slug %}">{{ client.name }}</a>
<a href="{% url 'episode_list' client.slug show.slug%}">{{ show.name }}</a>
<br/>

{% if prev_episode %}
  <a href="/main/E/{{ prev_episode.id }}">Prev: {{prev_episode.state }} {{prev_episode.name }}</a>
{% else %}
  Prev: (none, at start of list)
{% endif %}
<br/>
{% if next_episode %}
<a href="/main/E/{{ next_episode.id }}">Next: {{next_episode.state }} {{next_episode.name }}</a>
{% else %}
  Next: (none, at end of list)
{% endif %}

<table>
<tbody>
<tr><td> Title</td><td><b>{{episode.name}}</b></td></tr>
<tr><td> Author(s)</td><td>{{episode.authors}} </td></tr>
<tr><td> Location</td><td>{{episode.location}} </td></tr>
<tr><td>Date</td><td>{{episode.start|date:"b D d"}}</td></tr>
<tr><td>Start</td><td>{% if same_dates %}{{episode.start|date:"H:i"}}{% else %}{{episode.start}}{% endif %}</td>
<td>First Raw Start</td><td>{% if same_dates %}{{clrffs.0.0.raw_file.start|date:"H:i"}}{% else %}{{clrffs.0.0.faw_file.start}}{% endif %}</td></tr>
<tr><td>Duration</td><td>{{episode.duration}}</td></tr>
<tr><td>End</td><td> {% if same_dates %}{{episode.end|date:"H:i"}}{% else %}{{episode.end}}{% endif %} </td>
<td>Last Raw End</td> {% with clrffs|last as last_clrffs %}{% with last_clrffs.0.raw_file.end as end %} <td>{% if same_dates %} {{end|date:"H:i"}} {% else %} {{end}} {% endif %}</td> {% endwith %} {% endwith %}
</tr>
</tbody>
</table>
{% if episode.conf_url %}
  <a href="{{episode.conf_url}}">{{episode.conf_url}}</a><br/>
{% endif %}
Admin: <a href="{% url 'admin:main_episode_change' episode.id%}">episode</a>
<a href="{% url 'admin:main_cut_list_changelist' %}?episode__id__exact={{episode.id}}">cut list</a>
<br>

<a href="/databrowse/main/episode/objects/{{episode.id}}/">databrowse</a>
<a href="{% url 'raw_list' episode.id %}{{episode.slug}}.m3u">raw-playlist</a>
<a href="{% url 'enc_list' episode.id %}{{episode.slug}}.m3u">encoded-files-playlist</a>
{% if episode.host_url %}
  <a href="{{episode.host_url}}">host</a>
  {# <a href="http://blip.tv/file/{{episode.host_url}}?skin=rss">rss</a> #}
  {#<a href={{episode.host_url}}>host</a> #}
{% endif %}
<a href="{% url 'pdf' 'release_agreements' show.id episode.id %}{{episode.slug}}.pdf">release</a>
{% if episode.public_url %}
  <a href={{episode.public_url}}>public</a>
{% endif %}
<br/>
<a href={% url 'episode_logs' episode.id %}>logs</a><br/>

<a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/titles/{{episode.slug}}.svg"> svg</a>
<a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/titles/{{episode.slug}}.png"> png</a><br/>


<video src="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/ogv/{{episode.slug}}.ogv" controls width=200 ></video>
<a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/ogv/{{episode.slug}}.ogv">ogv</a>
<a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/mp4/{{episode.slug}}.mp4">mp4</a>

<form action="" method="POST">{% csrf_token %}
{% if user.is_authenticated %}
  <input type="submit" value="Save" />
{% else %}
  <p>(Not logged in)</p>
{% endif %}
<table border=1>
<tbody>
{{ episode_form }}
</tbody>
</table>


{% if user.is_authenticated %}
  <input type="submit" value="Save" />
{% else %}
  <p>(Not logged in)</p>
{% endif %}

{{ clrfformset.management_form }}
<table border=1>
<tbody>
{% for cl,clrfform in clrffs %}

  {% if clrfform.errors %}
  <tr> <td> {% for field in clrfform %}{{ field.errors }}{% endfor %} </td></tr>
  {% endif %}

  <tr>
  <td>
  {{clrfform.clid}}
  <b>~/Videos/veyepar/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.filename}}</b>
  <table border=1>
  <tbody>
    <tr>
    <td>
    {{clrfform.clid}}
      <table border=1>
      <tbody>
<tr><td> {{ clrfform.sequence.label_tag }}{{ clrfform.sequence }}</td></tr>
<tr><td> <a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.filename}}">{{ cl.raw_file.filename }}</a></td></tr>
<tr><td> <a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.basename}}.ogv" target=foo>{{ cl.raw_file.basename }}.ogv</a></td></tr>
<tr><td> <a href="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.basename}}.png">{{cl.raw_file.basename}}.png</a></td></tr>
<tr><td> <video src ="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.basename}}.ogv" controls width=200
    poster ="{{MEDIA_URL}}/{{client.slug}}/{{show.slug}}/dv/{{location.slug}}/{{cl.raw_file.basename}}.png"
    ></video>
    </td></tr>
     </tbody>
     </table>
    <td>
    <table border=1>
    <tbody>
      <tr> <th></th> <th>Raw File</th> <th>Cut List</th> </tr>

      <tr><td></td>
        <td>{#{ clrfform.trash.label_tag }}{{ clrfform.trash }#}</td>
        <td>{{ clrfform.apply.label_tag }}{{ clrfform.apply }}
</td>
      </tr>

     <tr> <td>Start</td><td><b>{% if same_dates %}{{cl.raw_file.start|date:"H:i:s"}}{% else %}{{cl.raw_file.start}}{% endif %}</b></td> <td>{{ clrfform.start }}</td> </tr>
      <tr> <td>Duration:</td> <td>{{cl.raw_file.duration}}</td> </tr>
      <tr> <td>End</td><td> {% if same_dates %}{{cl.raw_file.end|date:"H:i:s"}}{% else %}{{cl.raw_file.end}}{% endif %} </td> <td>{{ clrfform.end }}</td> </tr>
      <tr> <td>Comments:</td> <td>{#{clrfform.rf_comment}#}</td> <td>{{clrfform.cl_comment}}</td> </tr>
      <tr> <td>
         {{ clrfform.split.label_tag }}{{ clrfform.split }}
</td>
      <td><a href="{% url 'admin:main_raw_file_change' cl.raw_file.id%}">admin</a></td>
      <td>
<a href="{% url 'admin:main_cut_list_change' cl.id%}">admin</a>
<a href="{% url 'admin:main_cut_list_change' cl.id%}delete/">delete</a>
	 </td>
      </tr>

    </tbody>
    </table>
    </td>

  </tbody>
  </table>
  </tr>

  {% if cl.raw_file.ocrtext %}
  <tr>
  <td>
  <table border=1>
  <tbody>
    <tr>
    <td>{{cl.raw_file.ocrtext}}</td>
    </tr>
  </tbody>
  </table>
  </td>
  </tr>
  {% endif %}

{% endfor %}
</tbody>
</table>

{# { episode_form.state } #}

{% if user.is_authenticated %}
  <input type="submit" value="Save" />
{% else %}
  <p>(Not logged in)</p>
{% endif %}
</form>

{% endblock %}
